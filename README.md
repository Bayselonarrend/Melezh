![image](/media/cover_s.png)



# Melezh

[![OpenIntegrations](media/addon.svg)](https://github.com/Bayselonarrend/OpenIntegrations)
[![OneScript](media/oscript.svg)](https://github.com/EvilBeaver/OneScript)


Серверная версия Открытого пакета интеграций, предоставляющая единый настраиваемый HTTP API для доступа к его библиотекам и произвольным `.os` скриптам (расширениям), с возможностью установки значений по умолчанию, веб-консолью и встроенным логированием входящих запросов

## Принцип работы

Данный сервер устанавливается поверх `oint` - консольного приложения [Открытого пакета интеграций](https://github.com/Bayselonarrend/OpenIntegrations), и позволяет удаленно вызывать его методы по средством HTTP-запросов из любого места так, как это происходило бы в консоли на локальной машине. Melezh использует встроенный в OneScript сервер Kestrel для приема HTTP запросов, а затем интерпретирует их в команды `oint` (или модулей-расширений) для дальнейшего выполнения

Решение имеет гибкую систему настроек, позволяющую определить ограничения списка доступных команд и методов, а также установить значения параметров для выполнения команд по умолчанию. Это позволяет как просто уменьшить количество передаваемых данных, так и скрыть чувствительные данные от клиентской стороны в случае необходимости


## Пример начальной настройки

В этом примере создается новый файл проекта с настройкой обработкичка GET-запросов для функции `ОтправитьТекстовоеСообщение` из библиотеки работы с Telegram. Также в нем устанавливается значение по умолчанию для параметра `token` без возможности перезаписи ("строгий")

```powershell

melezh СоздатьПроект                 --path R:\test_proj.melezh
melezh ДобавитьОбработчикЗапросов    --proj R:\test_proj.melezh --lib telegram --func ОтправитьТекстовоеСообщение --method GET
melezh УстановитьАргументОбработчика --proj R:\test_proj.melezh --handler 42281f11b --arg token --value "***" --strict true
melezh ЗапуститьПроект               --proj R:\test_proj.melezh --port 7788

```

Обработчик будет доступен на `localhost:7788/42281f11b`, где `42281f11b` - идентификатор, получаемый при вызове `ДобавитьОбработчикЗапросов`, являясь одновременно и ключем обработчика для настройки, и URL эндпоинтом для обращений

Пример запроса для отправки текстового сообщения:

```url
http://localhost:7788/42281f11b?chat=123123123&text="Hello world!"
```

Как вы могли заметить, мы не передаем токен, так как он установлен по умолчанию

## Web UI

Кроме CLI интерфейса, для более простой интерактивной настройки и управления, можно использовать встроенную в Melezh веб-консоль:

![chrome_aDGtJZRrD8](https://github.com/user-attachments/assets/25762182-19b5-446c-8135-e87339cd7b02)

*На записи: вход в консоль, добавление нового обработчика для создания новости в Bitrix24 с указанием двух параметров по умолчанию, отключение двух обработчиков, просмотр подробностей одного из последних событий, просмотр всех логов по одному из обработчиков за сегодня*

<br>

**Веб-консоль позволяет:**
- Следить за последними событиями сервера
- Добавлять, изменять и удалять обработчики, менять состав параметров по умолчанию
- Включать и отключать обработчики на время
- Просматривать подробные логи по каждому обработанному запросу
- Изменять настройки сервера

Если вы только начинаете работу с Melezh, то рекомендуется начать именно с этого режима. Получить доступ к веб-консоли можно по адресу `localhost:<ваш порт>/ui` после создания и запуска проекта

## Установка

<img src="/media/box_s.png" align="left" width="200">

<br>

Melezh может быть установлен при помощи Windows-установщика, `rpm` или `deb`-пакета, пакета для OneScript, а также внутри Docker-контейнера. Необходимые файлы находятся в релизах данного репозитория <br><hr>
*Узнать больше о способе и процессе установки можно на [соответствующей странице документации](https://opi-test.neocities.org/docs/Addons/Melezh/Start/Installation)*

<br>

## Применение

Наиболее уместно использование Melezh в следующих случаях:

+ **Когда использование других вариантов поставки ОПИ невозможно** <br>
  Если интеграция необходима в системе, где возможность установки нового ПО ограничена, а платформа 1С отсутствует или имеет неподдерживаемую версию, то Melezh может решить эту проблему - достаточно иметь хотя бы один способ отправки HTTP-запросов, например `curl` или ту же старую версию платформы 1С:Предприятие

+ **Когда интеграция подразумевает использование секретных данных, которые нельзя хранить на стороне клиента** <br>
  Если реализация обмена требуется на стороне, где чувствительные данные могут быть скомпрометированы (например, в рамках работ по договору с другой компанией), то Melezh позволит как скрыть сами эти данные, так и ограничить перечень действий, для которых последние можно будет использовать

+ **Когда необходим централизированный доступ контроль** <br>
  Также Melezh может просто стать вашим централизированным Gateway для работы с различными сервисами - легким в настройке, с единым API и непрерывным логированием всех запросов, вне зависимости от того, какие интеграции и из каких систем вам необходимы в данный момент

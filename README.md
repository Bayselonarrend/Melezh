
![cover](/media/cover_s.png)



# Melezh

[![OpenIntegrations](media/addon.svg)]([https://github.com/EvilBeaver/OneScript](https://github.com/Bayselonarrend/OpenIntegrations))
[![OneScript](media/oscript.svg)](https://github.com/EvilBeaver/OneScript))


Аддон CLI версии Открытого пакета интеграций, позволяющий запускать ОПИ в режиме сервера для удаленного вызова любых процедур и функций из его набора

## Назначение аддона

Данный аддон устанавливается поверх `oint` - консольного приложения Открытого пакета интеграций, и позволяет удаленно вызывать его методы по средством HTTP-запросов из любого места так, как это происходило бы в консоли на локальной машине. Melezh использует встроенный в OneScript сервер Kestrel для приема HTTP запросов, а затем интерпретирует их в команды `oint` для дальнейшего выполнения

Решение имеет гибкую систему настроек, позволяющую определить ограничения списка доступных команд и методов, а также установить значения параметров для выполнения команд по умолчанию. Это позволяет как просто уменьшить количество передаваемых данных, так и скрыть чувствительные данные от клиентской стороны в случае необходимости

Наиболее уместно использование Melezh в следующих случаях:

+ **Когда использование других вариантов поставки ОПИ невозможно** <br>
  Если интеграция необходима в системе, где возможность установки нового ПО ограничена, а платформа 1С отсутствует или имеет неподдерживаемую версию, то Melezh может решить эту проблему - достаточно иметь хотя бы один способ отправки HTTP-запросов, например `curl` или ту же старую версию платформы 1С:Предприятие

+ **Когда интеграция подразумевает использование секретных данных, которые нельзя хранить на стороне клиента** <br>
  Если реализация обмена требуется на стороне, где чувствительные данные могут быть скомпрометированы (например, в рамках работ по договору с другой компанией), то Melezh позволит как скрыть сами эти данные, так и ограничить перечень действий, для которых последние можно будет использовать

+ **Когда необходим простой способ интеграции с self-hosted решениями** <br>
  Помимо публичных API, в составе Открытого пакета интеграций присутствуют также методы для работы с self-hosted решениями, врое PostgreSQL, MySQL, Ollama и пр. Запуск Melezh рядом с ними позволит использовать его в качестве простого прокси-сервера, избавляя от необходимости открытия портов для самих этих технологий

## Пример начальной настройки

В этом примере создается новый файл проекта с настройкой обработкичка GET-запросов для функции `ОтправитьТекстовоеСообщение` из библиотеки работы с Telegram. Также в нем устанавливается значение по умолчанию для параметра `token` без возможности перезаписи

```powershell

melezh СоздатьПроект                 --path R:\test_proj.melezh
melezh ДобавитьОбработчикЗапросов    --proj R:\test_proj.melezh --lib telegram --func ОтправитьТекстовоеСообщение --method GET
melezh УстановитьАргументОбработчика --proj R:\test_proj.melezh --handler 42281f11b --arg token --value "***" --strict true
melezh ЗапуститьПроект               --proj R:\test_proj.melezh --port 7788

```

Обработчик будет доступен на `localhost:7788/42281f11b`, где `42281f11b` - идентификатор, получаемый при вызове `ДобавитьОбработчикЗапросов`

Пример запроса для отправки текстового сообщения:

```url
http://localhost:7788/42281f11b?chat=123123123&text="Hello world!"
```
